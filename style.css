const intro = document.getElementById("intro");
const heart = document.getElementById("heart");
const scene = document.getElementById("scene");
const tree = document.getElementById("tree");
const text = document.getElementById("text");
const counter = document.getElementById("counter");
const music = document.getElementById("music");

let started = false;

function startExperience() {
  if (started) return;
  started = true;

  console.log("Experiencia iniciada");

  // Oculta intro y muestra escena
  if (intro) intro.style.display = "none";
  if (scene) scene.style.display = "block";

  // Música (solo funciona tras interacción real)
  if (music) {
    music.currentTime = 30;
    music.play().then(() => {
      console.log("Música reproduciéndose");
    }).catch(err => {
      console.log("Audio bloqueado:", err);
    });
  }

  // Animación árbol
  if (tree) tree.classList.add("grow");

  // Mostrar texto después
  setTimeout(() => {
    if (text) text.classList.add("show");
  }, 5000);

  startCounter();
  startFloatingHearts();
}

/* CLICK DIRECTO AL CORAZÓN */
if (heart) {
  heart.addEventListener("click", startExperience);
}

/* RESPALDO: cualquier toque inicia */
document.body.addEventListener("click", startExperience, { once: true });

/* ======================
   CONTADOR
====================== */
function startCounter() {
  const startDate = new Date("2018-08-06T00:00:00");

  setInterval(() => {
    const now = new Date();
    let diff = now - startDate;

    const seconds = Math.floor(diff / 1000) % 60;
    const minutes = Math.floor(diff / (1000 * 60)) % 60;
    const hours = Math.floor(diff / (1000 * 60 * 60)) % 24;
    const days = Math.floor(diff / (1000 * 60 * 60 * 24));

    if (counter) {
      counter.innerHTML = `
        ${days} días ${hours} horas
        ${minutes} minutos ${seconds} segundos
      `;
    }
  }, 1000);
}

/* ======================
   CORAZONES FLOTANDO
====================== */
function startFloatingHearts() {
  setInterval(() => {
    const h = document.createElement("div");
    h.className = "floating-heart";
    h.innerHTML = "❤️";
    h.style.left = Math.random() * 100 + "vw";
    h.style.animationDuration = 3 + Math.random() * 3 + "s";
    document.body.appendChild(h);

    setTimeout(() => h.remove(), 6000);
  }, 400);
}
/* INTRO */
#intro {
  text-align: center;
  transition: opacity 1s;
}

#intro.fade-out {
  opacity: 0;
}

/* CORAZÓN */
#heart {
  font-size: 90px;
  cursor: pointer;
  transition: transform 0.5s;
}

#heart.ball {
  font-size: 40px;
  border-radius: 50%;
}

#heart.drop {
  animation: drop 1.5s ease-in forwards;
}

@keyframes drop {
  0% { transform: translateY(0); }
  70% { transform: translateY(300px); }
  85% { transform: translateY(250px); }
  100% { transform: translateY(300px); }
}

/* ESCENA */
#scene {
  display: none;
  flex-direction: column;
  align-items: center;
}

/* ÁRBOL */
#tree {
  width: 0;
  height: 0;
  background: pink;
  border-radius: 10px;
  transition: all 3s ease;
}

#tree.grow {
  width: 120px;
  height: 220px;
}

/* TEXTO */
#text p {
  opacity: 1;
  margin: 8px 0;
}
/* ESCENA */
#scene {
  display: none;
  flex-direction: column;
  align-items: center;
  text-align: center;
}

/* CORAZÓN */
#heart {
  font-size: 90px;
  cursor: pointer;
  transition: transform 0.4s;
}

#heart.ball {
  font-size: 40px;
  border-radius: 50%;
}

#heart.fall {
  animation: fall 1.6s ease-out forwards;
}

@keyframes fall {
  0% { transform: translateY(0); }
  70% { transform: translateY(280px); }
  85% { transform: translateY(240px); }
  100% { transform: translateY(280px); }
}

/* ÁRBOL (placeholder limpio, NO fondo raro) */
#tree {
  width: 120px;
  height: 180px;
  border: 3px solid pink;
  border-radius: 10px;
  margin: 20px 0;
  opacity: 0;
  transition: opacity 2s ease;
}

#tree.show {
  opacity: 1;
}

/* TEXTO */
#text p {
  margin: 10px 0;
  font-size: 16px;
  line-height: 1.5;
}
