const intro = document.getElementById("intro");
const heart = document.getElementById("heart");
const scene = document.getElementById("scene");
const tree = document.getElementById("tree");
const text = document.getElementById("text");
const counter = document.getElementById("counter");
const music = document.getElementById("music");

let started = false;

function startExperience() {
  if (started) return;
  started = true;

  console.log("Experiencia iniciada");

  // Oculta intro y muestra escena
  if (intro) intro.style.display = "none";
  if (scene) scene.style.display = "block";

  // Música (solo funciona tras interacción real)
  if (music) {
    music.currentTime = 30;
    music.play().then(() => {
      console.log("Música reproduciéndose");
    }).catch(err => {
      console.log("Audio bloqueado:", err);
    });
  }

  // Animación árbol
  if (tree) tree.classList.add("grow");

  // Mostrar texto después
  setTimeout(() => {
    if (text) text.classList.add("show");
  }, 5000);

  startCounter();
  startFloatingHearts();
}

/* CLICK DIRECTO AL CORAZÓN */
if (heart) {
  heart.addEventListener("click", startExperience);
}

/* RESPALDO: cualquier toque inicia */
document.body.addEventListener("click", startExperience, { once: true });

/* ======================
   CONTADOR
====================== */
function startCounter() {
  const startDate = new Date("2018-08-06T00:00:00");

  setInterval(() => {
    const now = new Date();
    let diff = now - startDate;

    const seconds = Math.floor(diff / 1000) % 60;
    const minutes = Math.floor(diff / (1000 * 60)) % 60;
    const hours = Math.floor(diff / (1000 * 60 * 60)) % 24;
    const days = Math.floor(diff / (1000 * 60 * 60 * 24));

    if (counter) {
      counter.innerHTML = `
        ${days} días ${hours} horas
        ${minutes} minutos ${seconds} segundos
      `;
    }
  }, 1000);
}

/* ======================
   CORAZONES FLOTANDO
====================== */
function startFloatingHearts() {
  setInterval(() => {
    const h = document.createElement("div");
    h.className = "floating-heart";
    h.innerHTML = "❤️";
    h.style.left = Math.random() * 100 + "vw";
    h.style.animationDuration = 3 + Math.random() * 3 + "s";
    document.body.appendChild(h);

    setTimeout(() => h.remove(), 6000);
  }, 400);
}
